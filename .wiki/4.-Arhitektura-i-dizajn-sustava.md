**Opis arhitekture**

PadelTime je web aplikacija za upravljanje padel klubovima, sadržajem i rezervacijama, izrađena kao Next.js modularni monolit temeljen na klijent–poslužitelj modelu. Kombinira SSR/ISR renderiranje, React UI i Server Actions kao primarni način komunikacije s bazom i backend logikom.

**Stil arhitekture**
•	Klijent–poslužitelj – temeljni komunikacijski obrazac između preglednika i Next.js poslužitelja.
•	Modularni monolit – svi moduli su u jednoj aplikaciji, ali logički izolirani.
•	SSR/ISR i server actions – renderiranje i obrada podataka prema modernim standardima.
•	Komponentna organizacija – UI podijeljen na višekratno iskoristive React komponente.

**Podsustavi**
1.	Autentifikacijski podsustav (Clerk)
Upravljanje identitetom korisnika, sesijama i zaštitom ruta.
2.	Podsustav upravljanja klubom
Uključuje upravljanje podacima o klubu, radnim vremenima, pravilima i osnovnim postavkama.
3.	Podsustav fotografija
Upload, brisanje i prikaz fotografija pomoću API ruta i AWS S3.
4.	Podsustav lekcija i pretplata
Rukuje kolekcijom lekcija, pretplata i njihovim cijenama.
5.	Cjenik (PriceList)
Upravljanje dodatnim uslugama i proizvodima.
6.	Setup Club Wizard
Početna konfiguracija kluba uz integraciju Google Places API-ja.

**Preslikavanje na radnu platformu**
•	Next.js aplikacija – deploy na Vercel ili kompatibilni Node hosting.
•	PostgreSQL – Neon baza podataka 
•	S3 Storage – za pohranu fotografija.
•	Clerk – SaaS servis za identitet i autentifikaciju.
Aplikacija je dostupna i preko Vercela na

**Spremišta podataka**
•	Relacijska baza podataka za strukturirane zapise (ACID).
•	Objektna pohrana za slike.

**Mrežni protokoli**
•	HTTPS za sve komunikacijske tokove.
•	HTTPS REST prema vanjskim servisima (Clerk, S3, Google Places).
•	HTTP POST za mutacije kroz server actions.

**Globalni upravljački tok**
1.	Korisnik otvara web stranicu.
2.	Next.js provodi SSR i provjeru sesije preko Clerk-a.
3.	Podaci se dohvaćaju iz PostgreSQL baze.
4.	Promjene se šalju server actions mehanizmom.
5.	UI se automatski osvježava.
6.	Fotografije se upravljaju kroz upload API i S3 storage.

**Obrazloženje odabira arhitekture**
Arhitektura sustava PadelTime odabrana je s ciljem postizanja jednostavne skalabilnosti, jasnog razdvajanja odgovornosti i održivosti koda tijekom daljnjeg razvoja aplikacije. Sustav koristi modernu web arhitekturu zasnovanu na klijent–poslužitelj modelu, gdje je klijent implementiran u okviru Next.js aplikacije, dok se poslovna logika i rad s bazom podataka izvode putem server actions.
Jedan od ključnih razloga za odabir ove arhitekture jest kombiniranje prednosti server-side renderinga i API funkcionalnosti bez potrebe za dodatnim backend servisima. Next.js server actions omogućuju izravnu integraciju s bazom podataka, čime se smanjuje kompleksnost sustava i uklanja potreba za posebnim REST API slojem. Ovakav pristup povećava sigurnost jer se svi ključni poslovni procesi izvršavaju isključivo na poslužiteljskoj strani, uz potpunu kontrolu pristupa i integraciju s Clerk autentifikacijom.

Arhitektura također omogućuje jasnu podjelu poslovne logike po funkcionalnim cjeline: upravljanje klubom, ažuriranje sadržaja, rad s fotografijama, cjenicima, lekcijama i pretplatama. Svaka funkcionalnost izolirana je u vlastitu server akciju i svoju zasebnu ui-sekciju, što značajno smanjuje međusobnu povezanost komponenti (low coupling) i povećava koheziju (high cohesion).
Dodatni argument za odabir ovakvog pristupa je jednostavna integracija vanjskih servisa: Clerk za autentifikaciju, Google Places za automatsko dohvaćanje adresa te S3 kompatibilna pohrana fotografija. Zahvaljujući modularnoj arhitekturi, integracija ovih servisa ne utječe na ostatak aplikacije i može se nadograditi ili zamijeniti bez narušavanja ostatka sustava.


_Odabrana arhitektura omogućuje:_
•	Skalabilnost – Next.js i Vercel omogućuju automatsko skaliranje ovisno o prometu.
•	Sigurnost – poslovna logika se izvršava u kontroliranom poslužiteljskom okruženju; autorizacija se provodi kroz Clerk i provjere userId-a.
•	Održivost – izolirane server akcije i modularne Next.js komponente olakšavaju refaktoring i daljnje širenje sustava.
•	Performanse – rendering i pristup bazi izvode se na serveru, dok su korisničke interakcije brze i lokalne.
Ova arhitektura u potpunosti zadovoljava potrebe sustava PadelTime, osigurava stabilnost u produkciji i omogućuje jednostavno proširenje u budućnosti, primjerice dodavanjem rezervacija terena, upravljanja terminima ili naprednijih analitika.


**Organizacija sustava na visokoj razini apstrakcije**
Sustav PadelTime organiziran je prema klijent–poslužitelj modelu, gdje se korisničko sučelje, poslovna logika i baza podataka nalaze u jasno odvojenim slojevima, ali međusobno djeluju kroz definirane protokole i server akcije.

 _Klijent–poslužitelj_
Frontend (Next.js 14, React komponentni model)
Koristi se za prikaz sadržaja korisniku te za interakciju kroz forme i vizualne sekcije. Frontend komponente pozivaju server akcije, dohvaćaju podatke i ažuriraju prikaz bez potrebe za reloadom stranice.
U UI sloj pripadaju komponente kao što su:
•	SetupClubForm
•	ContentSection
•	PhotosSection
•	LessonsSection
•	SubscriptionsSection
•	PriceListSection
Backend (Next.js server actions + PostgreSQL)

Poslužiteljska strana implementirana je putem server actions koje obavljaju:
•	provjeru autentifikacije i autorizacije
•	validaciju podataka
•	spremanje i čitanje iz baze
•	interakciju sa S3 i Google Places servisima
Ovaj sloj služi kao siguran posrednik između korisničkog sučelja i sustava za pohranu podataka.

_Baze podataka_
Središnji sustav za pohranu podataka je PostgreSQL, koji pohranjuje:
•	korisnike (users)
•	klubove (club)
•	radno vrijeme kluba (workhours)
•	sadržaj kluba (content)
•	fotografije (clubphoto)
•	lekcije (lessons)
•	pretplate (subscriptions)
•	cjenik (pricelist)
Svaka tablica dizajnirana je u skladu s pravilima relacijske normalizacije (3NF), a vanjski ključevi povezuju podatke s pripadajućim klubom putem atributa userid.

_Grafičko korisničko sučelje_
Grafičko sučelje implementirano u React-u omogućava:
•	responzivni prikaz
•	validaciju na klijentu
•	trenutni prikaz promjena nakon poziva server akcije
•	dinamičko kreiranje sadržaja bez dodatnih API poziva
Korisnik dobiva brzu i fluidnu interakciju uz minimalno opterećenje poslužitelja.


**Baza podataka**
 
**Dijagram baze podataka**

 
**Dijagram razreda**
Za potrebe sustava PadelTime koristi se relacijska baza podataka PostgreSQL na Neonu.
Baza služi kao centralizirano spremište za sve poslovne podatke:
•	korisnici (users),
•	podaci o klubu (club),
•	radno vrijeme (workhours),
•	sadržaj (content),
•	fotografije (clubphoto),
•	lekcije (lessons),
•	pretplate (subscriptions),
•	cjenik (pricelist).
Relacijski model je normaliziran (3NF): višestruke vrijednosti (više lekcija, pretplata, fotografija, stavki cjenika) izdvojene su u zasebne tablice povezane s users.

**users**
•	userid (TEXT, PK) – jedinstveni identifikator korisnika dobiven od autentifikacijskog servisa (Clerk userId).
•	role (TEXT) – uloga korisnika u sustavu; vrijednosti mogu biti ’player’ ili ’club’.
•	created_at (TIMESTAMP) – vrijeme kada je korisnički račun kreiran u bazi.

**club**
•	userid (TEXT, PK, FK → users.userid) – jedinstveni identifikator kluba; ujedno i identifikator korisnika iz tablice users.
•	clubname (TEXT) – naziv padel kluba.
•	clubaddress (TEXT) – adresa kluba dobivena putem Google Places servisa ili ručnim unosom.
•	rules (TEXT) – pravila ponašanja ili korištenja kluba.
•	created_at (TIMESTAMP) – vrijeme kada je zapis o klubu kreiran.

**workhours**
•	workhours_id (SERIAL, PK) – jedinstveni identifikator zapisa radnog vremena.
•	userid (TEXT, FK → users.userid) – klub kojem pripada zapis.
•	day_of_week (SMALLINT) – dan u tjednu (1 označava ponedjeljak, 7 nedjelju).
•	start_time (TIME) – početak radnog vremena.
•	end_time (TIME) – kraj radnog vremena.

**content**
•	userid (TEXT, PK, FK → users.userid) – identifikator kluba na koji se sadržaj odnosi.
•	contenttext (TEXT) – opis sadržaja kluba, npr. generalne informacije o objektu.
•	updated_at (TIMESTAMP) – vrijeme posljednjeg ažuriranja sadržaja.

**clubphoto**
•	photo_id (SERIAL, PK) – jedinstveni identifikator pojedine fotografije.
•	userid (TEXT, FK → users.userid) – identifikator kluba kojem fotografija pripada.
•	photolink (TEXT) – URL fotografije, primjerice link prema S3 spremištu.
•	created_at (TIMESTAMP) – vrijeme kada je fotografija dodana sustavu.

**lessons**
•	lessonid (SERIAL, PK) – jedinstveni identifikator lekcije.
•	userid (TEXT, FK → users.userid) – identifikator kluba koji je objavio lekciju.
•	lessoninfo (TEXT) – opis lekcije, uključujući trajanje, instruktora i detalje programa.
•	price (NUMERIC(10,2)) – cijena lekcije.
•	created_at (TIMESTAMP) – vrijeme kada je lekcija dodana.

**subscriptions**
•	subid (SERIAL, PK) – jedinstveni identifikator pretplate.
•	userid (TEXT, FK → users.userid) – klub koji nudi pretplatu.
•	subinfo (TEXT) – opis pretplatnog paketa.
•	duration (INTEGER) – trajanje pretplate izraženo u broju dana.
•	price (NUMERIC(10,2)) – cijena pretplatnog paketa.
•	created_at (TIMESTAMP) – vrijeme kada je pretplata kreirana.

**pricelist**
•	productid (SERIAL, PK) – jedinstveni identifikator proizvoda ili usluge.
•	userid (TEXT, FK → users.userid) – klub kojem proizvod/usluga pripada.
•	productname (TEXT) – naziv proizvoda ili usluge u cjeniku.
•	price (NUMERIC(10,2)) – cijena dotičnog proizvoda ili usluge.
•	created_at (TIMESTAMP) – vrijeme kada je stavka dodana u cjenik.



**UML dijagram stanja** – Životni ciklus kluba

Dijagram prikazuje kako stanje kluba (objekta) mijenja svoje stanje tijekom vremena, ovisno o interakcijama korisnika i uvjetima unutar sustava. Fokus je na procesu inicijalnog postavljanja i aktivacije kluba u PadelTime aplikaciji.

_Objekt sustava_
•	Klub u sustavu (logički objekt koji odgovara zapisu u tablici club i povezanim zapisima u workhours).

_Stanja objekta_
•	Klub još nije  postavljen  
Početno stanje u kojem korisnik ima kreiran račun (Clerk korisnik), ali za njega još ne postoji zapis u tablici club. Klub nije vidljiv u dashboardu, a korisnik se preusmjerava na /setup-club prilikom pokušaja pristupa administraciji kluba.

_	Ispunjavanje forme_
Stanje u kojem korisnik popunjava formu na ruti /setup-club. Unosi naziv kluba, adresu (pomoću Google Places autocomplete-a ili ručno), radno vrijeme (putem WorkHoursSelector komponente) i pravila kluba. U ovom stanju klub još nije zapisan u bazu i nije aktivan.

_Validacija_
Stanje u kojem sustav provjerava unesene podatke i autorizaciju korisnika. Validacija uključuje provjeru:
•	je li korisnik prijavljen (auth()),
•	je li uloga korisnika club u tablici users,
•	jesu li obavezna polja (naziv, adresa, radno vrijeme, pravila) ispravno popunjena,
•	ne postoji li već zapis o klubu za tog korisnika.

_	Spremanje podataka_
Stanje u kojem sustav upisuje podatke u bazu:
•	kreira se novi zapis u tablici club (osnovni podaci o klubu),
•	upisuju se radni sati u tablicu workhours za svaki dan u tjednu,
•	eventualno se bilježi vrijeme kreiranja zapisa.

 _Klub aktivan_
Završno stanje u kojem klub postoji u tablici club i ima definirano radno vrijeme. Klub je vidljiv na dashboardu (ClubDashboard), vlasnik kluba može pristupiti ruti /club-management i upravljati fotografijama, sadržajem, lekcijama, pretplatama i cjenikom. U tom stanju klub je funkcionalno “spreman za rad” u aplikaciji.
Događaji i uvjeti prijelaza

_Ulazak u /setup-club_
Događaj koji uzrokuje prelazak iz stanja Klub još nije u stanje Ispunjavanje forme.
Preduvjet: korisnik je prijavljen i njegova uloga u tablici users je club, ali još ne postoji zapis u club.

_Submit forme_
Događaj koji pokreće prelazak iz stanja Ispunjavanje forme u stanje Validacija.
Preduvjet: korisnik je ispunio formu i kliknuo na gumb za spremanje.

_Greška pri validaciji_
Ako validacija otkrije problem (neispravni ili nepotpuni podaci, neautoriziran korisnik, već postojeći klub), dijagram prikazuje povratak iz stanja Validacija u stanje Ispunjavanje forme, uz prikaz poruke o grešci korisniku.

_Validno_
Ako su svi podaci ispravni i korisnik je autoriziran, događa se prijelaz iz stanja Validacija u stanje Spremanje podataka.

_Insert OK_

Nakon uspješnog izvođenja SQL naredbi (INSERT INTO club i INSERT INTO workhours), sustav prelazi iz stanja Spremanje podataka u stanje Klub aktivan.
U slučaju greške pri upisu, proces bi se vratio u neku varijantu stanja s greškom (npr. ponovno ispunjavanje forme), ovisno o implementaciji.

_Hijerarhija stanja_
U ovom modelu stanja su linearno organizirana:
•	Klub još nije, Ispunjavanje forme, Validacija, Spremanje podataka i Klub aktivan predstavljaju osnovna, uzastopna stanja u životnom ciklusu kluba.
•	Nije uvedena dodatna hijerarhija (super-stanja) jer je proces postavljanja kluba relativno jednostavan i može se jasno izraziti linearnim slijedom.
•	Potencijalna proširenja u budućnosti mogla bi uključivati stanja poput Klub suspendiran ili Klub arhiviran, no ona trenutno nisu implementirana u sustavu.





**UML dijagram aktivnosti** – Uklanjanje fotografije kluba
 
UML dijagram aktivnosti za proces uklanjanja fotografije kluba prikazuje tijek izvršavanja koraka u sustavu prilikom brisanja postojeće fotografije iz galerije kluba. Dijagram jasno razdvaja radnje korisnika, web aplikacije, baze podataka i (potencijalnog) vanjskog servisa za pohranu (npr. AWS S3) te prikazuje međusobnu interakciju ovih elemenata.


**Identifikacija procesa**
Proces koji se modelira je Uklanjanje fotografije kluba.
Glavni cilj procesa je omogućiti vlasniku kluba da iz galerije u aplikaciji trajno ukloni neželjenu fotografiju. Sustav pritom mora provjeriti identitet korisnika, obrisati zapis iz baze podataka te, po potrebi, obrisati fizičku datoteku sa storage servisa.

**Aktivnosti unutar procesa**

_Korisničke radnje_
•	Odabir fotografije za brisanje: Korisnik (klub) u sučelju otvara sekciju Photos i odabire konkretnu fotografiju.
•	Klik na “Delete”: Korisnik potvrđuje da želi ukloniti odabranu fotografiju.

_Radnje web aplikacije_
•	Poziv handlera u React komponenti: PhotosSection prima klik na gumb “Delete” i poziva odgovarajuću funkciju (npr. handleDelete(photoUrl)).
•	Poziv server akcije deletePhoto: Client komponenta šalje zahtjev Next.js server akciji s parametrima userId i photoLink.
•	Provjera autentikacije i autorizacije: Server-side logika pomoću Clerk-a provjerava je li authUserId jednak proslijeđenom userId i je li korisnik vlasnik kluba.
•	Brisanje zapisa iz baze: Ako je provjera uspješna, sustav izvršava DELETE FROM clubphoto WHERE userid = ... AND photolink = ....
•	Provjera tipa URL-a: Aplikacija provjerava radi li se o fotografiji pohranjenoj na vanjskom storage servisu (npr. S3 URL).

_Interakcije s vanjskim sustavima_
•	Baza podataka:
o	Prima naredbu za brisanje zapisa iz tablice clubphoto.
o	Nakon uspješnog brisanja, baza više ne sadrži referencu na tu fotografiju.
•	Storage servis (npr. S3):
o	Ako je fotografija pohranjena na S3, server poziva funkciju za brisanje fizičke datoteke s vanjskog storage-a.
o	U protivnom se ovaj korak preskače.


_Ishodi_
•	Uspješno uklanjanje fotografije:
o	Zapis u tablici clubphoto je obrisan.
o	Ako je korišten S3, i fizička datoteka je uklonjena.
o	Frontend ponovno dohvaća listu fotografija i osvježava prikaz (galerija više ne prikazuje obrisanu fotografiju).

_Prikaz greške:_
o	Ako autentikacija ne uspije, korisnik nije vlasnik kluba ili dođe do pogreške pri brisanju, sustav vraća poruku o grešci (npr. “Unauthorized” ili “Failed to delete photo”), a fotografija ostaje vidljiva u galeriji.

_Tok procesa_
•	Početni pseudo-čvor označava početak procesa uklanjanja fotografije.
•	Korisnik klikom na gumb “Delete” inicira proces.
•	Web aplikacija poziva server akciju deletePhoto s pripadajućim parametrima.
•	Server provodi provjeru autentikacije i autorizacije.
•	Ako je provjera uspješna:
o	briše se zapis iz baze (clubphoto),
o	opcionalno se briše datoteka iz storage servisa,
o	frontend ponovno dohvaća fotografije i osvježava prikaz.
•	Ako provjera ne uspije ili dođe do sistemske greške, proces završava prikazom odgovarajuće poruke o grešci.
•	Završni pseudo-čvor označava kraj procesa nakon uspješnog ažuriranja galerije ili nakon prikaza greške.

_Pseudo-čvorovi_
•	Početni čvor: Početak procesa kada korisnik aktivira akciju brisanja.
•	Čvor odluke: Provjera uspješnosti autentikacije i autorizacije (grana authorized / unauthorized), te po potrebi odluka briše li se datoteka i sa S3.
•	Završni čvor: Kraj procesa, bilo uspješnim uklanjanjem fotografije iz galerije ili prikazom greške.






